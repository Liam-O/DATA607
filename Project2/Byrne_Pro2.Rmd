---
title: "Preparing Data for Downstream Data Analysis"
author: "Liam M. Byrne"
date: "`r Sys.Date()`"
output:
  rmdformats::readthedown:
    highlight: kate
---

```{r knitr_init, echo=FALSE, cache=FALSE, warning = FALSE}
library("knitr") 
library("rmdformats")
library("dtplyr")
library("data.table")
library("tidyr")
library("ggplot2")
library("dplyr")
## Global options
options(max.print="75")
opts_chunk$set(cache=TRUE,
               prompt=FALSE,
               tidy=TRUE,
               comment=NA,
               message=FALSE,
               warning=FALSE)
opts_knit$set(width=75)
```

***
# Introduction
## Overview



## Relevence



## Data Reference and Libraries



Outside of formatting packages, the libraries used for this project are:

* [`data.table`](https://cran.r-project.org/web/packages/data.table/data.table.pdf): Light-weight, fast development for data structure; not necessarily needed for this data set, but recommended under best practices.   
* [`dtplyr`](https://cran.r-project.org/web/packages/dtplyr/dtplyr.pdf): Data table back-end of `dplyr` for data manipulation.
* [`tidyr`](https://cran.r-project.org/web/packages/tidyr/tidyr.pdf): To produce tidy data from the `dplyr` pipeline.
* [`ggplot2`](https://cran.r-project.org/web/packages/ggplot2/ggplot2.pdf): Provides some advanced plotting utilities.

***

# Loading and Cleaning the Data
## 2010 Census Data

The 2010 census data, suggested by Brandon O'Hara, was released by the U.S Census Bureau on December 2014. The data provides annual estimates of the resident population for the United States, regions, states, and Puerto Rico from April 1, 2010 to July 1, 2014. The raw data, which was cleaned of descriptive attachments and merged cells, is available [here](https://raw.githubusercontent.com/Liam-O/DATA607/master/Project2/populaiton2012.csv). After uploading the data, the ten first observations are:

```{r}

file_link <- 
    "https://raw.githubusercontent.com/Liam-O/DATA607/master/Project2/pop2012.csv"

# Returns a data table
census2010  <- fread(file_link, header = TRUE, na.strings = "", data.table = TRUE)
knitr::kable(head(census2010,10))
```

The 2010 adjusted and raw variables are adjusted census data from April 2010 and the original data gathered, respectively. The Jul-10 to Jul-14 variables are projections based off the adjusted data. An unforseen effect of the basic clean-up process are null rows at the bottom of the list and the states begin with a period:

```{r}
knitr::kable(tail(census2010,10))
```

Removing the NULL rows:
```{r nullRemove}
census2010 <- census2010[rowSums(is.na(census2010)) != ncol(census2010),]
```

Removing the leading periods:

```{r}
census2010$area <- sub("^\\.", "", census2010$area)
```

The cleaned data now resembles the desired format:
```{r}
knitr::kable(head(census2010))

knitr::kable(tail(census2010))
```


The first five rows are calculated rows and should not be in the table. To tabulate them manually, especially the regional areas, would be too cumbersome. They will remain in the table due to their availability.

##Student Drinking

The alchol consumption for two Portuguese schools ("GP" - Gabriel Pereira or "MS" - Mousinho da Silveira) is available by area of study, [math](https://raw.githubusercontent.com/Liam-O/DATA607/master/Project2/student/student-mat.csv) and [Portuguese](https://raw.githubusercontent.com/Liam-O/DATA607/master/Project2/student/student-por.csv). This data was recomended by Oluwakemi Omotunde and the data dictionary is available [here](https://raw.githubusercontent.com/Liam-O/DATA607/master/Project2/student/student.txt)

```{r}
#Data for math students
st_math_link <- "https://raw.githubusercontent.com/Liam-O/DATA607/master/Project2/student/student-mat.csv"
student_math <- fread(st_math_link, header = TRUE, na.strings = "", data.table = TRUE)
knitr::kable(head(student_math))

#Data for Portuguese students
st_port_link <- "https://raw.githubusercontent.com/Liam-O/DATA607/master/Project2/student/student-por.csv"
student_port <- fread(st_port_link, header = TRUE, na.strings = "", data.table = TRUE)
knitr::kable(head(student_port))
```

The data is aleady clean, so no surgery is needed to before the transformation.

#Transform to Tidy Data
##2010 Census Data

The format of the census data violoates the rule that each observaiton is saved in its own row. The time series format puts the populaiton projections for July 2010 to July 2014 in one row. Also, the 2010 raw data will not be necessary in our future analysis, so we will remove this as well. By piping the data through some `tidyr` tools we get the desired result:

```{r}
census2010 <- census2010 %>%
    gather("year", "pop", 4:8) %>%
    subset(select = c(1,2,4,5)) %>%
    arrange(area)

census2010$pop <- as.numeric(gsub(",", "", census2010$pop))
knitr::kable(head(census2010,10))
```

##Student Drinking

The issue with the student data is that it is split over two tables depending on what class the student is taking, i.e. math or Portuguese. These tables need to be joined under one table.
```{r}
nrow(student_math)
nrow(student_port)

# Add major variable to distinguish between 
student_math[,"major"] <- "math"
student_port[,"major"] <- "Portuguese"

student <- rbind(student_math, student_port)
nrow(student)

```

All the data is combined under one table and we can do some analysis in the future.

# Analysis with Transformed Data
##Census Data

```{r}
census_region <- subset(census2010,
                        area == "Northeast" |
                            area == "Midwest" |
                            area == "South" |
                            area == "West")

ggplot(census_region, aes(x = year, y = pop)) +
    geom_point() +
    facet_wrap(~area)
```
    
```{r}
#census_diff <- subset(census2010$)
```